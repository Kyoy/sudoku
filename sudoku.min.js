var Sudoku=function(r){return this.opts=r,this.matrix={row:[],col:[],sec:[]},this.init(),this};Sudoku.prototype={opts:{difficulty:1},matrix:{},answers:{},cellMatrix:[],init:function(){var r=this,t=0;$("h1").text("Sudoku"),$("table").empty();for(var a=1;9>=a;a++){var e=$("<tr>");r.cellMatrix[a-1]=[];for(var i=1;9>=i;i++){var o=$("<td>");$(o).attr("i",a+"-"+i).attr("r",a-1).attr("c",i-1).attr("x",t).click(function(){r.moveCursor($(this).attr("i"))}),r.cellMatrix[a-1][i-1]=o,$(e).append(o),t++}$("#grid").append(e)}$($("td")[40]).addClass("active");for(var a=0;9>a;a++)this.matrix.row[a]=[0,0,0,0,0,0,0,0,0],this.matrix.col[a]=[0,0,0,0,0,0,0,0,0];for(var i=0;3>i;i++){this.matrix.sec[i]=[];for(var s=0;3>s;s++)this.matrix.sec[i][s]=[0,0,0,0,0,0,0,0,0]}this.populateMatrix(0,0)},populateMatrix:function(r,t){var a=this,e=function(r,t){for(var e,i,o=t+9*r;81>o;o++)if(e=Math.floor(o/9),i=o%9,0==a.matrix.row[e][i])return a.cellMatrix[e][i];return!1},i=e(r,t);if(i){for(var o=parseInt($(i).attr("r")),s=parseInt($(i).attr("c")),n=Math.floor(o/3),c=Math.floor(s/3),f=3*(o%3)+s%3,u=a.getLegalValues(o,s),l=0;l<u.length;l++){var d=u[l];if(a.matrix.row[o][s]=d,a.matrix.col[s][o]=d,a.matrix.sec[n][c][f]=d,a.populateMatrix(o,s))return!0;a.matrix.row[o][s]=0,a.matrix.col[s][o]=0,a.matrix.sec[n][c][f]=0}return!1}return a.answers=JSON.parse(JSON.stringify(a.matrix)),a.populateGrid(),!0},getRandInRange:function(r,t){return Math.floor(Math.random()*(t+1))+r},getLegalValues:function(r,t){for(var a=[1,2,3,4,5,6,7,8,9],e=Math.floor(r/3),i=Math.floor(t/3),o=0;9>o;o++){var s=parseInt(this.matrix.row[r][o]);if(s>0){var n=a.indexOf(s);n>-1&&a.splice(n,1)}}for(var c=0;9>c;c++){var s=parseInt(this.matrix.col[t][c]);if(s>0){var n=a.indexOf(s);n>-1&&a.splice(n,1)}}for(var f=0;9>f;f++){var s=parseInt(this.matrix.sec[e][i][f]);if(s>0){var n=a.indexOf(s);n>-1&&a.splice(n,1)}}for(var u=a.length-1;u>0;u--){var l=this.getRandInRange(0,u),d=a[u];a[u]=a[l],a[l]=d}return a},getCurrentCell:function(){return $(".active")},populateGrid:function(){var r=this,t=0;switch(r.opts.difficulty){case 1:t=r.getRandInRange(25,35);break;case 2:t=r.getRandInRange(35,50);break;case 3:t=r.getRandInRange(50,55);break;default:t=15}for(var a=0;t>a;a++){var e=Math.floor(9*Math.random()),i=Math.floor(9*Math.random());this.answers.row[e][i]="",this.answers.col[i][e]="";var o=Math.floor(e/3),s=Math.floor(i/3),n=3*(e%3)+i%3;this.answers.sec[o][s][n]=""}for(var c=0;9>c;c++)for(var f=0;9>f;f++){var u=this.answers.row[c][f];""!=u&&$(r.cellMatrix[c][f]).addClass("guide"),$(r.cellMatrix[c][f]).text(u)}this.theme()},check:function(){for(var r=!0,t=0;3>t;t++)for(var a=0;3>a;a++)for(var e=0;9>e;e++)this.matrix.sec[t][a][e]!=this.answers.sec[t][a][e]&&(r=!1);if(!r){r=!0;for(var i=this.answers,o=[],s=function(){return[1,2,3,4,5,6,7,8,9]},n=0;9>n;n++){o=s();for(var c=0;9>c;c++){var f=i.row[n][c],u=o.indexOf(f);u>-1?o.splice(u,1):r=!1}}for(var n=0;9>n;n++){o=s();for(var c=0;9>c;c++){var f=i.col[n][c],u=o.indexOf(f);u>-1?o.splice(u,1):r=!1}}for(var n=0;3>n;n++)for(var c=0;3>c;c++){o=s();for(var l=0;9>l;l++){var f=i.sec[n][c][l],u=o.indexOf(f);u>-1?o.splice(u,1):r=!1}}}r?($("h1").text("Congratulations!"),$(".grid").addClass("correct")):this.wrong()},wrong:function(){$("body").addClass("incorrect");var r=$("body>div");$(r).animate({marginLeft:"-100px"},{duration:150,queue:!1,complete:function(){$(r).animate({marginLeft:0,marginRight:"-100px"},{duration:150,queue:!1,complete:function(){$(r).animate({marginLeft:"-100px",marginRight:0},{duration:150,queue:!1,complete:function(){$(r).animate({marginLeft:0},150),setTimeout(function(){$("body").removeClass("incorrect")},2e3)}})}})}})},theme:function(){var r=this.opts.difficulty;$("body").attr("class",function(){return 1==r?"easy":2==r?"medium":"hard"}())},moveCursor:function(r){var t=this,a=$(t.getCurrentCell()).attr("i"),e=a.split("-"),i=function(r){$(t.getCurrentCell()).removeClass("active"),$("td[i="+r+"]").addClass("active")};if("string"==typeof r)return void i(r);switch(e=[Number(e[0]),Number(e[1])],r){case 1:var o=e[1]>1?e[1]-1:9;i(e[0]+"-"+o);break;case 2:var s=e[0]>1?e[0]-1:9;i(s+"-"+e[1]);break;case 3:var n=e[1]<9?e[1]+1:1;i(e[0]+"-"+n);break;case 4:var c=e[0]<9?e[0]+1:1;i(c+"-"+e[1]);break;default:console.log("Error: invalid cursor command")}},keyup:function(r){var t=r-48;return t>=0&&9>=t?void this.modifyCell(t):(t=r-96,void(t>=0&&9>=t&&this.modifyCell(t)))},modifyCell:function(r){var t=this.getCurrentCell();if(!$(t).hasClass("guide")){var a=parseInt($(t).attr("r")),e=parseInt($(t).attr("c")),i=Math.floor(a/3),o=Math.floor(e/3),s=3*(a%3)+e%3;0==r?$(t).text(""):$(t).text(r),this.answers.row[a][e]=r,this.answers.col[e][a]=r,this.answers.sec[i][o][s]=r}}},$(document).ready(function(){var r=new Sudoku({difficulty:2});$(this).on("keyup",function(t){var a=t.keyCode||t.which;switch(t.preventDefault(),a){case 37:r.moveCursor(1);break;case 38:r.moveCursor(2);break;case 39:r.moveCursor(3);break;case 40:r.moveCursor(4);break;case 8:r.modifyCell(0);break;case 48:r.modifyCell(0);break;case 96:r.modifyCell(0);break;case 46:r.modifyCell(0);break;case 83:r.check();break;case 81:r=new Sudoku({difficulty:1});break;case 87:r=new Sudoku({difficulty:2});break;case 69:r=new Sudoku({difficulty:3});break;default:r.keyup(a)}}),$("button").each(function(){$(this).click(function(){var t=parseInt($(this).data("verb"));4==t?r.check():r=new Sudoku({difficulty:t})}),$(this).mousedown(function(){$(this).addClass("focused")}),$(this).mouseup(function(){$(this).removeClass("focused")})})});